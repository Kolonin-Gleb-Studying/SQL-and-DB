Задача:

Создать процедуру по переводу денег. На вход процедуры Вы подаете:
1) id счета откуда перевести деньги
2) id счета куда перевести деньги
3) Сумма перевода



А в самой процедуре в переменных нужно задать:
1) id счета для перечисления комиссии
2) размер комиссии (если сумма меньше 1000 руб, то комиссия 3%, а если больше 1000 рублей - 1%)



--- Всё обернуть в транзакцию

Примечание:
Заверни транзакцию, что ты уже сделал в ПРОЦЕДУРУ

Процеруда хранится на сервере => ДЗ выполняю в Putty.

Нужно переписать логику с языка Python на SQL.


Выполнение:

DELIMITER //

CREATE PROCEDURE money_transfer (IN payer_id INT, IN receiver_id INT,  IN transfer_ammount FLOAT) 
BEGIN
	START TRANSACTION;

	DECLARE payer_money FLOAT;
	DECLARE bank_interest FLOAT DEFAULT 0;

	CASE
	WHEN (transfer_ammount < 1000) THEN
	   SET bank_interest = transfer_ammount / 100 * 3;
	ELSE
	   SET bank_interest = transfer_ammount / 100;
	END CASE;

	DECLARE cur_money_extractor CURSOR FOR SELECT money FROM hw1_banking WHERE id = 2 FOR UPDATE;
	OPEN cur_money_extractor;

	FETCH cur_money_extractor INTO payer_money;

	CASE payer_money
		WHEN payer_money < transfer_ammount + bank_interest THEN
			SELECT("Денег не хватит. Транзакция отменена!")
		ELSE
			UPDATE hw1_banking SET money = money - transfer_ammount WHERE id = 2;
      			UPDATE hw1_banking SET money = money + transfer_ammount WHERE id = 3;

      			UPDATE hw1_banking SET money = money - bank_interest WHERE id = 2;
      			UPDATE hw1_banking SET money = money + bank_interest WHERE id = 1;
	END CASE;
	CLOSE cur_money_extractor;
END //

DELIMITER ;